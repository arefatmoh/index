<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Read & Revive (አንባቢ) — Interactive Preview</title>
    <meta name="description" content="Single-file interactive preview of the Read & Revive (አንባቢ) bot features.">
    <style>
      :root {
        --bg: #0b1020;
        --surface: #121931;
        --surface-2: #0e1530;
        --text: #e7e9ee;
        --muted: #aab2c5;
        --primary: #6ea8fe;
        --primary-2: #4f91ff;
        --accent: #8ef0d0;
        --warning: #ffd166;
        --success: #55efc4;
        --danger: #ff7675;
        --shadow: 0 10px 30px rgba(0,0,0,.25);
        --radius: 14px;
      }
      [data-theme="light"] {
        --bg: #f7f9fc;
        --surface: #ffffff;
        --surface-2: #f1f5fb;
        --text: #0f172a;
        --muted: #4b5563;
        --primary: #2563eb;
        --primary-2: #1d4ed8;
        --accent: #10b981;
        --warning: #f59e0b;
        --success: #16a34a;
        --danger: #dc2626;
        --shadow: 0 10px 30px rgba(2,6,23,.1);
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; overflow-x: hidden; }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: radial-gradient(1200px 600px at 80% -10%, rgba(79,145,255,.18), transparent),
                    radial-gradient(1200px 600px at 0% 0%, rgba(142,240,208,.18), transparent),
                    var(--bg);
        color: var(--text);
        line-height: 1.5;
        width: 100%;
        max-width: 100vw;
      }
      a { color: var(--primary); text-decoration: none; }
      .container { width: min(1160px, 100%); padding: 0 16px; margin: 0 auto; box-sizing: border-box; }
      .glass {
        background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
        border: 1px solid rgba(255,255,255,.08);
        border-radius: var(--radius);
        backdrop-filter: blur(10px);
        box-shadow: var(--shadow);
      }
       header {
         position: sticky; top: 0; z-index: 10; backdrop-filter: blur(6px);
         background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,0));
         border-bottom: 1px solid rgba(255,255,255,.06);
       }
       .nav { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; flex-wrap: wrap; gap: 12px; }
       .brand { display: flex; align-items: center; gap: 10px; font-weight: 700; letter-spacing: .3px; min-width: 0; flex-shrink: 0; }
       .brand-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }
       .brand-mark { width: 36px; height: 36px; border-radius: 10px; display: grid; place-items: center; color: #09122e; flex-shrink: 0;
         background: conic-gradient(from 200deg, var(--primary), var(--accent)); box-shadow: 0 8px 18px rgba(79,145,255,.45);
       }
       .nav-actions { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; }
       .nav-actions .btn { font-size: 14px; padding: 8px 12px; white-space: nowrap; }
       .nav-actions .btn.ghost { display: none; }
       
       /* Mobile responsive navigation */
       @media (max-width: 768px) {
         .nav { flex-direction: column; align-items: stretch; gap: 8px; }
         .brand { justify-content: center; }
         .brand-text { max-width: none; }
         .nav-actions { justify-content: center; flex-wrap: wrap; gap: 4px; }
         .nav-actions .btn { font-size: 13px; padding: 6px 10px; flex: 1; min-width: 0; }
         .nav-actions .btn.ghost { display: inline-flex; }
         .nav-actions .btn:not(.ghost):not(#openBot) { display: none; }
       }
       
       @media (max-width: 480px) {
         .nav-actions .btn { font-size: 12px; padding: 6px 8px; }
         .brand-text { font-size: 16px; }
         .brand-mark { width: 32px; height: 32px; }
       }
       
       /* Prevent horizontal scrolling on all elements */
       * { max-width: 100%; }
       .hero h1 { word-wrap: break-word; hyphens: auto; }
       .hero .subtitle { word-wrap: break-word; }
       .grid { display: grid; gap: 20px; }
       .grid-2 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
       .grid-3 { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
       
       @media (max-width: 768px) {
         .container { padding: 0 12px; }
         .hero h1 { font-size: 2.5rem; line-height: 1.2; }
         .hero .subtitle { font-size: 1.1rem; }
         .grid-2, .grid-3 { grid-template-columns: 1fr; }
         .card { padding: 20px; }
         .btn { font-size: 14px; padding: 10px 12px; }
       }
       
       @media (max-width: 480px) {
         .container { padding: 0 8px; }
         .hero h1 { font-size: 2rem; }
         .hero .subtitle { font-size: 1rem; }
         .card { padding: 16px; }
         .btn { font-size: 13px; padding: 8px 10px; }
       }
       
       /* Chat demo mobile responsiveness */
       .chat-demo { max-width: 100%; overflow: hidden; }
       .chat-log { max-height: 400px; overflow-y: auto; }
       .chat-input { width: 100%; max-width: 100%; }
       .inline-kb-msg { max-width: 100%; overflow-x: auto; }
       .inline-kb { display: flex; flex-wrap: wrap; gap: 6px; max-width: 100%; }
       .ikb-btn { flex: 1; min-width: 0; font-size: 12px; padding: 6px 8px; }
       .suggestions { flex-wrap: wrap; gap: 6px; }
       .chip { font-size: 12px; padding: 6px 10px; }
       
       @media (max-width: 768px) {
         .chat-log { max-height: 300px; }
         .inline-kb { flex-direction: column; }
         .ikb-btn { flex: none; }
         .suggestions { justify-content: center; }
       }
       
       /* Table responsiveness */
       .table-container { overflow-x: auto; max-width: 100%; }
       table { min-width: 100%; }
       
       /* Modal responsiveness */
       .modal { 
         padding: 20px; 
         position: fixed; 
         top: 0; 
         left: 0; 
         right: 0; 
         bottom: 0; 
         z-index: 1000;
         display: flex;
         align-items: center;
         justify-content: center;
         overflow-y: auto;
       }
       .modal .glass {
         margin: 20px;
         max-height: calc(100vh - 40px);
         overflow-y: auto;
         position: relative;
       }
       
       /* Desktop - ensure modal appears below nav bar */
       @media (min-width: 769px) {
         .modal { 
           top: 80px; /* Start below navigation bar on desktop */
           align-items: flex-start;
           padding-top: 20px;
         }
         .modal .glass { 
           max-height: calc(100vh - 120px); /* Account for nav bar height */
           overflow-y: auto; /* Enable scrolling on desktop */
         }
         /* Specific promo modal desktop styling */
         #promoModal .glass {
           max-height: calc(100vh - 140px); /* Extra space for better scrolling */
         }
       }
       
       @media (max-width: 768px) {
         .modal { 
           padding: 16px; 
           top: 80px; /* Start below navigation bar */
           align-items: flex-start; /* Align to top instead of center */
           padding-top: 20px; /* Add some top padding */
         }
         .modal .glass { 
           margin: 16px; 
           max-height: calc(100vh - 120px); /* Account for nav bar height */
         }
         .modal h2 { font-size: 1.5rem; }
       }
       
       @media (max-width: 480px) {
         .modal { 
           padding: 12px; 
           top: 70px; /* Adjust for smaller nav bar */
           padding-top: 16px;
         }
         .modal .glass { 
           margin: 12px; 
           max-height: calc(100vh - 110px); /* Account for smaller nav bar */
         }
         .modal h2 { font-size: 1.3rem; }
       }
       
       /* Ensure modals appear below navigation */
       header { z-index: 1001; }
       .modal { z-index: 1000; }
      .btn { display: inline-flex; align-items: center; gap: 8px; border: 1px solid rgba(255,255,255,.08); color: var(--text);
        padding: 10px 14px; border-radius: 12px; background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)); cursor: pointer;
        transition: transform .12s ease, background .2s ease, border-color .2s ease; user-select: none; }
      .btn:hover { transform: translateY(-1px); border-color: rgba(255,255,255,.2); }
      .btn.primary { background: linear-gradient(180deg, var(--primary), var(--primary-2)); color: white; border: none; }
      .btn.ghost { background: transparent; }
      .btn-icon { width: 40px; height: 40px; display: grid; place-items: center; border-radius: 12px; }
      #openBot { background: linear-gradient(90deg, #22c55e, #16a34a); color:#061016; font-weight:700; border:none; box-shadow: 0 10px 24px rgba(34,197,94,.35); position: relative; }
      #openBot:hover { transform: translateY(-2px) scale(1.01); box-shadow: 0 14px 28px rgba(34,197,94,.45); }
      #openBot::after { content:""; position:absolute; inset:-2px; border-radius: 13px; padding:2px; background: linear-gradient(90deg, rgba(34,197,94,.6), rgba(79,145,255,.4)); -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0); mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; opacity:.6; }
      /* Sarfus CTA attractor */
      .cta-sarfus { position: relative; animation: attract 2.6s ease-in-out infinite; }
      @keyframes attract { 0% { transform: translateY(0); box-shadow: 0 10px 24px rgba(16,185,129,.35); }
        50% { transform: translateY(-1px) scale(1.015); box-shadow: 0 16px 30px rgba(16,185,129,.5); }
        100% { transform: translateY(0); box-shadow: 0 10px 24px rgba(16,185,129,.35); } }
      .cta-sarfus::before { content: ""; position: absolute; inset: 0; background: radial-gradient(120px 40px at 10% 50%, rgba(255,255,255,.35), transparent), radial-gradient(120px 40px at 90% 50%, rgba(255,255,255,.25), transparent); opacity: .45; pointer-events: none; mix-blend-mode: screen; animation: shimmer 3.8s linear infinite; }
      @keyframes shimmer { 0% { opacity:.35; } 50% { opacity:.6; } 100% { opacity:.35; } }
      .btn:focus-visible, .ikb-btn:focus-visible, .chip:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; box-shadow: 0 0 0 4px rgba(142,240,208,.15); }
      .hero { display: grid; grid-template-columns: 1.15fr .85fr; gap: 28px; padding: 48px 0 18px; align-items: center; }
      @media (max-width: 920px) { .hero { grid-template-columns: 1fr; padding: 28px 0 10px; } }
      .hero h1 { font-size: clamp(28px, 4vw, 44px); line-height: 1.12; margin: 0 0 10px; }
      .subtitle { color: var(--muted); margin: 0 0 18px; }
      .subtitle.hero { font-size: clamp(18px, 2.2vw, 24px); color: var(--text); opacity: .96; }
      .pills { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0 18px; }
      .pill { font-size: 13px; padding: 6px 10px; border-radius: 999px; border: 1px dashed rgba(255,255,255,.18); color: var(--muted); }
      .hero-card { padding: 18px; }
      .grid { display: grid; gap: 16px; }
      .grid.cols-3 { grid-template-columns: repeat(3, 1fr); }
      .grid.cols-2 { grid-template-columns: repeat(2, 1fr); }
      .grid.cols-4 { grid-template-columns: repeat(4, 1fr); }
      @media (max-width: 920px) { .grid.cols-3, .grid.cols-4 { grid-template-columns: 1fr; } .grid.cols-2 { grid-template-columns: 1fr; } }
      .card { padding: 16px; border-radius: var(--radius); border: 1px solid rgba(255,255,255,.06); background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.01)); }
      .card h3 { margin: 0 0 4px; font-size: 18px; }
      .muted { color: var(--muted); }
      .section { padding: 24px 0; }
      .section h2 { margin: 0 0 12px; font-size: 22px; }
      .badge { display: inline-flex; align-items: center; gap: 8px; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.08); cursor: pointer; background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.01)); }
      .badge:hover { border-color: rgba(255,255,255,.2); }
      .badge.locked { opacity: .55; filter: grayscale(.6); cursor: default; }
      .badge.locked:hover { border-color: rgba(255,255,255,.08); }
      .hint { display:flex; align-items:center; gap:8px; color: var(--muted); font-size: 13px; margin: 6px 0 10px; }
      .arrow { width: 18px; height: 18px; }
      .pulse { position: absolute; width: 10px; height: 10px; border-radius: 999px; background: var(--accent); box-shadow: 0 0 0 rgba(142,240,208, 0.7); animation: pulse 1.6s infinite; }
      @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(142,240,208,.5);} 70% { box-shadow: 0 0 0 12px rgba(142,240,208,0);} 100% { box-shadow: 0 0 0 0 rgba(142,240,208,0);} }
      .chat { display: grid; grid-template-rows: auto 1fr auto; height: 420px; overflow: hidden; }
      .chat-log { padding: 12px; overflow: auto; display: flex; flex-direction: column; gap: 10px; }
      .bubble { max-width: 78%; padding: 10px 12px; border-radius: 14px; border: 1px solid rgba(255,255,255,.08); }
      .bubble.user { margin-left: auto; background: linear-gradient(180deg, rgba(79,145,255,.2), rgba(79,145,255,.08)); }
      .bubble.bot { background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); }
      .bubble.typing { color: var(--muted); font-style: italic; opacity: .9; }
      .inline-kb { display:flex; gap:8px; flex-wrap:wrap; padding: 8px 12px; border-top: 1px dashed rgba(255,255,255,.06); }
      .ikb-btn { padding: 8px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,.12); background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.01)); color: var(--text); cursor: pointer; }
      .ikb-btn:hover { border-color: rgba(255,255,255,.24); }
      .inline-kb-msg { align-self: flex-start; padding: 6px 8px 2px; }
      .chat-input { display: flex; gap: 8px; padding: 10px; border-top: 1px solid rgba(255,255,255,.06); }
      input[type="text"] { flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.12); background: var(--surface); color: var(--text); }
      .kbd { font: 600 12px/1 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; padding: 4px 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,.14); color: var(--muted); }
      .suggestions { display:flex; gap:8px; flex-wrap:wrap; padding: 8px 12px; border-top: 1px dashed rgba(255,255,255,.06); }
      .chip { padding: 8px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,.12); background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.01)); cursor: pointer; color: var(--text); }
      .chip:hover { border-color: rgba(255,255,255,.24); }
      .table { width: 100%; border-collapse: collapse; }
      .table th, .table td { text-align: left; padding: 10px; border-bottom: 1px solid rgba(255,255,255,.06); }
      .progress { height: 10px; background: rgba(255,255,255,.08); border-radius: 999px; overflow: hidden; }
      .progress > span { display: block; height: 100%; background: linear-gradient(90deg, var(--accent), var(--primary)); }
      .modal { display: none; background: rgba(0,0,0,.45); }
      .modal.open { display: flex; }
      /* Promo modal */
      #promoModal .glass { 
        max-width: 600px; 
        width: 100%; 
        text-align: center; 
        position: relative;
        overflow-y: auto; /* Enable scrolling for all content */
        background: linear-gradient(135deg, 
          rgba(79,145,255,.12) 0%, 
          rgba(142,240,208,.08) 50%, 
          rgba(34,197,94,.1) 100%);
        border: 2px solid rgba(79,145,255,.2);
        box-shadow: 
          0 25px 50px rgba(0,0,0,.3),
          0 0 0 1px rgba(255,255,255,.1),
          inset 0 1px 0 rgba(255,255,255,.2);
        /* Custom scrollbar styling */
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* Internet Explorer 10+ */
      }
      
      /* Hide scrollbar for WebKit browsers (Chrome, Safari, Edge) */
      #promoModal .glass::-webkit-scrollbar {
        display: none;
      }
      
      #promoModal .hero {
        position: relative;
        padding: 32px 24px 24px;
        background: linear-gradient(135deg, 
          rgba(79,145,255,.15) 0%, 
          rgba(142,240,208,.1) 100%);
        border-bottom: 1px solid rgba(255,255,255,.1);
      }
      
      #promoModal .hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(ellipse at top, rgba(255,255,255,.1) 0%, transparent 70%);
        pointer-events: none;
      }
      
      #promoModal h2 { 
        margin: 0 0 16px; 
        font-size: clamp(28px, 5vw, 42px); 
        line-height: 1.1; 
        font-weight: 800;
        background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 2px 4px rgba(0,0,0,.1);
        position: relative;
        z-index: 1;
      }
      
      #promoModal .hero p { 
        margin: 0; 
        font-size: 18px; 
        color: var(--text); 
        opacity: .9;
        font-weight: 500;
        position: relative;
        z-index: 1;
      }
      
      #promoModal .close-x { 
        position: absolute; 
        top: 16px; 
        right: 16px; 
        z-index: 2;
        background: rgba(255,255,255,.1);
        border: 1px solid rgba(255,255,255,.2);
        backdrop-filter: blur(10px);
        transition: all .2s ease;
      }
      
      #promoModal .close-x:hover {
        background: rgba(255,255,255,.2);
        transform: scale(1.1);
      }
      
      #promoModal .body {
        padding: 24px;
        position: relative;
      }
      
      #promoModal .body .muted { 
        margin: 0 0 24px; 
        font-size: 16px; 
        line-height: 1.6;
        color: var(--muted);
      }
      
      #promoModal .feature-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 24px;
      }
      
      #promoModal .feature-card {
        padding: 20px;
        border-radius: 16px;
        background: linear-gradient(135deg, 
          rgba(255,255,255,.08) 0%, 
          rgba(255,255,255,.03) 100%);
        border: 1px solid rgba(255,255,255,.1);
        transition: all .3s ease;
        position: relative;
        overflow: hidden;
      }
      
      #promoModal .feature-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, 
          rgba(79,145,255,.05) 0%, 
          rgba(142,240,208,.03) 100%);
        opacity: 0;
        transition: opacity .3s ease;
      }
      
      #promoModal .feature-card:hover::before {
        opacity: 1;
      }
      
      #promoModal .feature-card:hover {
        transform: translateY(-2px);
        border-color: rgba(255,255,255,.2);
        box-shadow: 0 8px 25px rgba(0,0,0,.15);
      }
      
      #promoModal .feature-card h3 {
        margin: 0 0 8px;
        font-size: 18px;
        font-weight: 700;
        color: var(--text);
        position: relative;
        z-index: 1;
      }
      
      #promoModal .feature-card .muted {
        margin: 0;
        font-size: 14px;
        line-height: 1.5;
        position: relative;
        z-index: 1;
      }
      
      #promoModal .cta-card {
        border: 2px solid rgba(16,185,129,.4);
        background: linear-gradient(135deg, 
          rgba(16,185,129,.1) 0%, 
          rgba(34,197,94,.05) 100%);
        box-shadow: 0 8px 25px rgba(16,185,129,.2);
      }
      
      #promoModal .cta-card:hover {
        border-color: rgba(16,185,129,.6);
        box-shadow: 0 12px 30px rgba(16,185,129,.3);
      }
      
      #promoModal .actions { 
        display: flex; 
        flex-direction: column; 
        gap: 12px; 
        margin: 0;
        padding: 24px;
        background: linear-gradient(180deg, 
          rgba(255,255,255,.05) 0%, 
          rgba(255,255,255,.01) 100%);
        border-top: 1px solid rgba(255,255,255,.1);
      }
      
      #promoModal .actions .btn { 
        font-size: 16px; 
        padding: 16px 24px; 
        border-radius: 16px;
        font-weight: 600;
        transition: all .3s ease;
        position: relative;
        overflow: hidden;
      }
      
      #promoModal .actions .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, 
          transparent, 
          rgba(255,255,255,.2), 
          transparent);
        transition: left .5s ease;
      }
      
      #promoModal .actions .btn:hover::before {
        left: 100%;
      }
      
      #promoModal .actions .btn.primary {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%);
        border: none;
        box-shadow: 0 8px 20px rgba(79,145,255,.3);
        color: white;
      }
      
      #promoModal .actions .btn.primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 25px rgba(79,145,255,.4);
      }
      
      #promoModal .actions .btn:not(.primary) {
        background: linear-gradient(135deg, 
          rgba(255,255,255,.1) 0%, 
          rgba(255,255,255,.05) 100%);
        border: 1px solid rgba(255,255,255,.2);
        color: var(--text);
      }
      
      #promoModal .actions .btn:not(.primary):hover {
        background: linear-gradient(135deg, 
          rgba(255,255,255,.15) 0%, 
          rgba(255,255,255,.08) 100%);
        border-color: rgba(255,255,255,.3);
        transform: translateY(-1px);
      }
      
      #promoModal .cta-sarfus {
        background: linear-gradient(135deg, #34d399 0%, #10b981 100%) !important;
        color: #06231a !important;
        border: none !important;
        font-weight: 800 !important;
        font-size: 16px !important;
        padding: 12px 20px !important;
        border-radius: 12px !important;
        box-shadow: 0 8px 20px rgba(16,185,129,.3) !important;
        transition: all .3s ease !important;
        position: relative !important;
        overflow: hidden !important;
      }
      
      #promoModal .cta-sarfus::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, 
          transparent, 
          rgba(255,255,255,.3), 
          transparent);
        transition: left .5s ease;
      }
      
      #promoModal .cta-sarfus:hover::before {
        left: 100%;
      }
      
      #promoModal .cta-sarfus:hover {
        transform: translateY(-2px) scale(1.02) !important;
        box-shadow: 0 12px 25px rgba(16,185,129,.4) !important;
      }
      
      @media (max-width: 768px) {
        #promoModal .glass { 
          max-width: 90vw; 
          margin: 16px; 
          max-height: calc(100vh - 120px); /* Account for nav bar height */
          overflow-y: auto; /* Ensure scrolling if content is too tall */
        }
        #promoModal .hero {
          padding: 24px 20px 20px;
        }
        #promoModal h2 { 
          font-size: clamp(24px, 6vw, 32px); 
          margin-bottom: 12px;
        }
        #promoModal .hero p { 
          font-size: 16px; 
        }
        #promoModal .body {
          padding: 20px;
        }
        #promoModal .body .muted {
          font-size: 15px;
          margin-bottom: 20px;
        }
        #promoModal .feature-grid {
          grid-template-columns: 1fr;
          gap: 12px;
          margin-bottom: 20px;
        }
        #promoModal .feature-card {
          padding: 16px;
        }
        #promoModal .feature-card h3 {
          font-size: 17px;
          margin-bottom: 8px;
        }
        #promoModal .feature-card .muted {
          font-size: 14px;
          line-height: 1.4;
        }
        #promoModal .cta-sarfus {
          font-size: 14px !important;
          padding: 10px 16px !important;
          margin-top: 8px !important;
        }
        #promoModal .actions { 
          padding: 20px; 
          gap: 10px;
        }
        #promoModal .actions .btn { 
          font-size: 15px; 
          padding: 14px 20px; 
        }
      }
      
      @media (max-width: 480px) {
        #promoModal .glass { 
          max-width: 95vw; 
          margin: 12px; 
          max-height: calc(100vh - 110px); /* Account for smaller nav bar */
          overflow-y: auto; /* Ensure scrolling if content is too tall */
        }
        #promoModal .hero {
          padding: 20px 16px 16px;
        }
        #promoModal h2 { 
          font-size: clamp(20px, 7vw, 28px); 
          margin-bottom: 10px;
        }
        #promoModal .hero p { 
          font-size: 15px; 
        }
        #promoModal .body {
          padding: 16px;
        }
        #promoModal .body .muted {
          font-size: 14px;
          margin-bottom: 16px;
        }
        #promoModal .feature-grid {
          gap: 10px;
          margin-bottom: 16px;
        }
        #promoModal .feature-card {
          padding: 14px;
        }
        #promoModal .feature-card h3 {
          font-size: 16px;
          margin-bottom: 6px;
        }
        #promoModal .feature-card .muted {
          font-size: 13px;
          line-height: 1.3;
        }
        #promoModal .cta-sarfus {
          font-size: 13px !important;
          padding: 8px 14px !important;
          margin-top: 6px !important;
        }
        #promoModal .actions { 
          padding: 16px; 
          gap: 8px;
        }
        #promoModal .actions .btn { 
          font-size: 14px; 
          padding: 12px 16px; 
        }
      }
      
      /* Badge modal mobile responsiveness */
      #badgeModal .glass { 
        max-width: 520px; 
        margin: 20px; 
        max-height: calc(100vh - 40px);
        overflow-y: auto;
      }
      
      @media (max-width: 768px) {
        #badgeModal .glass { 
          max-width: 90vw; 
          margin: 16px; 
          max-height: calc(100vh - 120px); /* Account for nav bar height */
        }
      }
      
      @media (max-width: 480px) {
        #badgeModal .glass { 
          max-width: 95vw; 
          margin: 12px; 
          max-height: calc(100vh - 110px); /* Account for smaller nav bar */
          padding: 12px;
        }
        #badgeModal h3 { font-size: 18px; }
        #badgeModal .muted { font-size: 14px; }
      }
      /* Accordion */
      .accordion { border: 1px solid rgba(255,255,255,.08); border-radius: 12px; overflow: hidden; }
      .acc-item + .acc-item { border-top: 1px solid rgba(255,255,255,.06); }
      .acc-header { width: 100%; text-align: left; background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.01)); border: none; color: var(--text); padding: 14px; display:flex; justify-content:space-between; align-items:center; cursor:pointer; }
      .acc-header .chev { transition: transform .2s ease; }
      .acc-content { max-height: 0; overflow: hidden; transition: max-height .35s ease; background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.01)); }
      .acc-content .inner { padding: 12px 14px; }
      .acc-item.open .acc-content { max-height: 800px; }
      .acc-item.open .acc-header .chev { transform: rotate(90deg); }
      .segmented { display:inline-flex; gap:8px; background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.06); padding:6px; border-radius: 999px; }
      .segmented button { border:none; background: transparent; color: var(--muted); padding:8px 12px; border-radius: 999px; cursor: pointer; }
      .segmented button.active { background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.08)); color: var(--text); }
      .row-anim { transition: background-color .3s ease; }
      .row-anim.highlight { background-color: rgba(142,240,208,.08); }
      .vis-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
      @media (max-width: 800px) { .vis-row { grid-template-columns: 1fr; } }
      .chart { width: 100%; height: 160px; background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,0)); border: 1px solid rgba(255,255,255,.06); border-radius: 12px; display: grid; place-items: center; }
      footer { padding: 30px 0 50px; color: var(--muted); }
      .footer-note { display:flex; gap:8px; align-items:center; justify-content:center; flex-wrap:wrap; }
      .footer-note a { color: var(--accent); font-weight: 700; }
      .footer-note .heart { color: #ff5a77; }
      /* Section reveal */
      .reveal { opacity: 0; transform: translateY(14px); transition: opacity .5s ease, transform .5s ease; }
      .reveal.in { opacity: 1; transform: translateY(0); }
      @media (prefers-reduced-motion: reduce) {
        .btn { transition: none; }
        .reveal, .row-anim { transition: none; transform: none !important; }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container nav">
         <div class="brand">
           <div class="brand-mark">📚</div>
           <div class="brand-text">Read & Revive (አንባቢ)</div>
         </div>
        <div class="nav-actions">
          <button class="btn ghost" id="themeToggle" aria-label="Toggle theme">🌗 Theme</button>
          <a class="btn" href="#features">Features</a>
          <a class="btn" href="#demo">Live Demo</a>
          <a class="btn primary" href="#get-started">Get Started</a>
          <a class="btn" id="openBot" href="https://t.me/sarfus_devlab_bot" target="_blank" rel="noopener noreferrer">🚀 Open Bot</a>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="hero">
        <div>
          <h1>Make Reading a Daily Joy — Track, Compete, Achieve.</h1>
          <p class="subtitle">All-in-one companion for readers: set goals, track progress, earn achievements, and join leagues. This page is a live, offline preview of the bot experience.</p>
          <p class="subtitle hero">This page is a demo describing the Read & Revive (አንባቢ) bot.</p>
          <div class="pills">
            <span class="pill">🎯 Goals</span>
            <span class="pill">🏆 Achievements</span>
            <span class="pill">👥 Leagues</span>
            <span class="pill">📊 Stats</span>
            <span class="pill">💫 Motivation</span>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <a href="#demo" class="btn primary">Try the Demo</a>
            <a href="#features" class="btn">Explore Features</a>
          </div>
        </div>
        <div class="glass hero-card">
          <div class="grid cols-2">
            <div class="card">
              <div class="muted" style="margin-bottom:6px;">Today's Goal</div>
              <div style="font-weight:700; font-size:22px;">20 pages</div>
              <div class="progress" style="margin-top:10px;"><span style="width:62%"></span></div>
              <div class="muted" style="margin-top:6px; font-size:12px;">62% complete</div>
            </div>
            <div class="card">
              <div class="muted" style="margin-bottom:6px;">Current Streak</div>
              <div style="font-weight:700; font-size:22px;">🔥 7 days</div>
              <div class="muted" style="margin-top:6px; font-size:12px;">Keep going!</div>
            </div>
            <div class="card">
              <div class="muted" style="margin-bottom:6px;">League Rank</div>
              <div style="font-weight:700; font-size:22px;">🥈 2nd / 12</div>
              <div class="muted" style="margin-top:6px; font-size:12px;">Community Mode</div>
            </div>
            <div class="card">
              <div class="muted" style="margin-bottom:6px;">Achievements</div>
              <div style="font-weight:700; font-size:22px;">🏆 6 unlocked</div>
              <div class="muted" style="margin-top:6px; font-size:12px;">View your collection</div>
            </div>
          </div>
        </div>
      </section>

      <section class="section reveal" id="features">
        <h2>Features</h2>
        <div class="grid cols-3">
          <div class="card"><h3>📚 Individual Mode</h3><div class="muted">Read at your own pace. Track pages, set goals, and visualize progress.</div></div>
          <div class="card"><h3>👥 Community Mode</h3><div class="muted">Join leagues, climb leaderboards, and stay motivated together.</div></div>
          <div class="card"><h3>🏆 Achievements</h3><div class="muted">Earn badges for streaks, milestones, and community contributions.</div></div>
          <div class="card"><h3>📊 Statistics</h3><div class="muted">Clean insights: reading time, pace, completion rate, and streaks.</div></div>
          <div class="card"><h3>⏰ Reminders</h3><div class="muted">Smart nudges to keep your habit on track. Fully configurable.</div></div>
          <div class="card"><h3>🧑‍💼 Profile</h3><div class="muted">Customize display name, bio, goals. See detailed personal insights.</div></div>
        </div>
        <div class="accordion" style="margin-top:12px;">
          <div class="acc-item">
            <button class="acc-header" aria-expanded="false"><span>How it works — Step by Step</span><span class="chev">▶</span></button>
            <div class="acc-content">
              <div class="inner">
                <div class="grid cols-2">
                  <div class="card"><h3>1) Start & Register</h3><div class="muted">Send <span class="kbd">/start</span>. Provide name and basic info. Choose your mode any time.</div></div>
                  <div class="card"><h3>2) Pick a Mode</h3><div class="muted">🆕 Individual: solo tracking. 👥 Community: join a league, compete, and collaborate.</div></div>
                  <div class="card"><h3>3) Choose Books</h3><div class="muted">Use featured books or add your own (title, author, pages). Switch books anytime.</div></div>
                  <div class="card"><h3>4) Set Goals</h3><div class="muted">Quick presets (10–30 pages) or custom. The bot tracks daily goal completion and streaks.</div></div>
                  <div class="card"><h3>5) Log Progress</h3><div class="muted">Use <span class="kbd">/progress</span> or inline actions to record pages. Milestones trigger achievements.</div></div>
                  <div class="card"><h3>6) Reminders</h3><div class="muted">Set a daily reminder (e.g., 8:00 PM). Frequency presets and custom time supported.</div></div>
                  <div class="card"><h3>7) Achievements</h3><div class="muted">Unlock streaks (3/7/14/30 days), completion milestones (25/50/75/100%), and community badges.</div></div>
                  <div class="card"><h3>8) Leagues</h3><div class="muted">Browse leagues, join with validation, view leaderboards, and participate in challenges.</div></div>
                  <div class="card"><h3>9) Stats & Insights</h3><div class="muted">View reading time, pace, completion %, top days, and trends from your profile.</div></div>
                  <div class="card"><h3>10) Admin (Optional)</h3><div class="muted">Admins can create/manage leagues, set books, export data, and broadcast updates.</div></div>
                </div>
              </div>
            </div>
          </div>
          <div class="acc-item">
            <button class="acc-header" aria-expanded="false"><span>💫 Daily Motivation & Tips</span><span class="chev">▶</span></button>
            <div class="acc-content"><div class="inner">
              <div class="muted">You’ll receive scheduled messages to stay inspired and focused:</div>
              <ul class="muted" style="margin:6px 0 0 16px;">
                <li>🌅 Morning Motivational Quotes (8:00 AM).</li>
                <li>💡 Afternoon Reading Tips (3:00 PM).</li>
                <li>🎉 Achievement celebrations and streak encouragement.</li>
              </ul>
              <div class="muted" style="margin-top:6px;">Customize reminders and explore categories in the demo above.</div>
            </div></div>
          </div>
        </div>
      </section>

      <section class="section reveal" id="howto">
        <h2>How-To Guides</h2>
        <div class="accordion">
          <div class="acc-item open">
            <button class="acc-header" aria-expanded="true"><span>⏰ Set a Reminder</span><span class="chev">▶</span></button>
            <div class="acc-content" style="max-height:600px;"><div class="inner">
              <ul class="muted" style="margin:6px 0 0 16px;">
                <li>Open the bot and type <span class="kbd">/reminder</span> or tap <b>Reminder</b> from the menu.</li>
                <li>Choose a preset time (e.g., 7:00 AM, 8:00 PM) or enter a custom time (12h AM/PM).</li>
                <li>Change or disable any time.</li>
              </ul>
            </div></div>
          </div>
          <div class="acc-item">
            <button class="acc-header" aria-expanded="false"><span>🎯 Set Daily Goal</span><span class="chev">▶</span></button>
            <div class="acc-content"><div class="inner">
              <ul class="muted" style="margin:6px 0 0 16px;">
                <li>Use <span class="kbd">/progress</span> or <b>Set Goal</b> inline button.</li>
                <li>Pick 10/15/20/25/30 pages or enter a custom number.</li>
                <li>Progress bars and streaks update automatically.</li>
              </ul>
            </div></div>
          </div>
          <div class="acc-item">
            <button class="acc-header" aria-expanded="false"><span>📚 Add a Book</span><span class="chev">▶</span></button>
            <div class="acc-content"><div class="inner">
              <ul class="muted" style="margin:6px 0 0 16px;">
                <li>Tap <b>Books → Add Book</b>.</li>
                <li>Provide Title, Author, and Total Pages.</li>
                <li>Or browse Featured and select with one tap.</li>
              </ul>
            </div></div>
          </div>
          <div class="acc-item">
            <button class="acc-header" aria-expanded="false"><span>🏆 Track Achievements</span><span class="chev">▶</span></button>
            <div class="acc-content"><div class="inner">
              <ul class="muted" style="margin:6px 0 0 16px;">
                <li>Unlock milestones at 25/50/75/100% completion.</li>
                <li>Streak badges at 3/7/14/30/100 days.</li>
                <li>Community badges when you join/participate in leagues.</li>
              </ul>
            </div></div>
          </div>
          <div class="acc-item">
            <button class="acc-header" aria-expanded="false"><span>👥 Join a League</span><span class="chev">▶</span></button>
            <div class="acc-content"><div class="inner">
              <ul class="muted" style="margin:6px 0 0 16px;">
                <li>Use <span class="kbd">/league</span> or <b>Join League</b>.</li>
                <li>Browse available leagues, view details, and join.</li>
                <li>See Weekly/Monthly/All-time leaderboards.</li>
              </ul>
            </div></div>
          </div>
          <div class="acc-item">
            <button class="acc-header" aria-expanded="false"><span>🧑‍💼 Edit Profile</span><span class="chev">▶</span></button>
            <div class="acc-content"><div class="inner">
              <ul class="muted" style="margin:6px 0 0 16px;">
                <li>Use <span class="kbd">/profile</span> or <b>Profile</b>.</li>
                <li>Edit display name, bio, goals.</li>
                <li>Open detailed stats & insights.</li>
              </ul>
            </div></div>
          </div>
        </div>
      </section>

      <section class="section reveal" id="demo">
        <h2>Interactive Chat Demo</h2>
        <div class="grid cols-2">
          <div class="glass chat">
            <div class="chat-log" id="chatLog" aria-live="polite"></div>
            <div style="padding: 8px; border-top: 1px solid rgba(255,255,255,.06); display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn kbd" data-prompt="/start">/start</button>
              <button class="btn kbd" data-prompt="/progress">/progress</button>
              <button class="btn kbd" data-prompt="/league">/league</button>
              <button class="btn kbd" data-prompt="/achievements">/achievements</button>
              <button class="btn kbd" data-prompt="/profile">/profile</button>
            </div>
            <div class="inline-kb" id="inlineKb" aria-label="Inline keyboard" style="display:none;"></div>
            <div class="suggestions" id="suggestions"></div>
            <div class="chat-input">
              <input type="text" id="chatInput" placeholder="Type a message (offline demo)…" aria-label="Message input">
              <button class="btn primary" id="sendBtn">Send</button>
            </div>
          </div>
          <div class="grid cols-1">
            <div class="card">
              <h3>💡 Tips</h3>
              <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
                <div class="segmented" role="tablist" aria-label="Tips category">
                  <button role="tab" class="active" data-tipcat="technique">Technique</button>
                  <button role="tab" data-tipcat="health">Health</button>
                  <button role="tab" data-tipcat="habit">Habit</button>
                </div>
                <button class="btn" id="tipPause" aria-pressed="false">⏸ Pause</button>
              </div>
              <div class="muted" id="tipRotator">Reading Tip: Even 10 minutes daily builds habit.</div>
            </div>
            <div class="card">
              <h3>✨ Motivational Quote</h3>
              <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
                <div class="segmented" role="tablist" aria-label="Quotes theme">
                  <button role="tab" class="active" data-quote="reading">Reading</button>
                  <button role="tab" data-quote="growth">Growth</button>
                </div>
                <button class="btn" id="quotePause" aria-pressed="false">⏸ Pause</button>
              </div>
              <div class="muted" id="quoteRotator">Every page you read brings you closer to wisdom!</div>
            </div>
          </div>
        </div>
      </section>

      <section class="section reveal" id="achievements">
        <h2>Achievements</h2>
        <div class="hint"><svg class="arrow" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 12h12M13 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> Click a badge to see details, tiers and XP</div>
        <div style="position:relative;">
          <span class="pulse" style="top:-4px; left:6px;"></span>
          <div class="grid cols-4" id="achGrid"></div>
        </div>
      </section>

      <section class="section reveal" id="leagues">
        <h2>League Leaderboard</h2>
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:6px;">
            <div class="segmented" role="tablist" aria-label="Leaderboard period">
              <button role="tab" class="active" data-period="weekly">Weekly</button>
              <button role="tab" data-period="monthly">Monthly</button>
              <button role="tab" data-period="all">All-time</button>
            </div>
            <div class="muted" style="font-size:12px;">Your row is highlighted</div>
          </div>
          <table class="table" id="leaderboard">
            <thead><tr><th>#</th><th>User</th><th>Pages</th><th>Progress</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="section reveal" id="stats">
        <h2>Statistics</h2>
        <div class="vis-row">
          <div class="chart" id="donutChart" role="img" aria-label="Reading completion donut"></div>
          <div class="chart" id="barChart" role="img" aria-label="Weekly pages bar chart"></div>
        </div>
        <div class="vis-row" style="margin-top:12px;">
          <div class="chart" id="donutGoals" role="img" aria-label="Goals achieved donut"></div>
          <div class="chart" id="streakSpark" role="img" aria-label="Streak trend sparkline"></div>
        </div>
        <div class="grid cols-3" style="margin-top:12px;">
          <div class="card"><div class="muted">Total Pages</div><div style="font-size:26px; font-weight:700;"><span id="countPages">0</span></div></div>
          <div class="card"><div class="muted">Books Finished</div><div style="font-size:26px; font-weight:700;"><span id="countBooks">0</span></div></div>
          <div class="card"><div class="muted">Longest Streak</div><div style="font-size:26px; font-weight:700;"><span id="countStreak">0</span> days</div></div>
        </div>
      </section>

      <section class="section reveal" id="get-started">
        <div class="glass" style="padding:18px; display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between;">
          <div>
            <h2 style="margin:0 0 6px;">Ready to Read More?</h2>
            <div class="muted">Try the demo above, set a goal, and explore achievements. This page works entirely offline.</div>
          </div>
          <a href="#demo" class="btn primary">Open Demo</a>
        </div>
      </section>
    </main>

    <footer class="container">
      <div class="footer-note">
        <span>Powered by</span>
        <strong>Read & Revive (አንባቢ) Community</strong>
        <span>• Developed by</span>
        <a href="https://www.sarfusinnovation.com" target="_blank" rel="noopener noreferrer">Sarfus Innovation</a>
        <span>— with <span class="heart">❤</span> for readers.</span>
      </div>
    </footer>

    <div class="modal" id="badgeModal" role="dialog" aria-modal="true" aria-labelledby="badgeTitle">
      <div class="glass" style="padding:16px; max-width:520px; width:100%; margin:20px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
          <h3 id="badgeTitle" style="margin:0;">Achievement</h3>
          <button class="btn btn-icon" id="badgeClose" aria-label="Close">✖</button>
        </div>
        <div class="muted" id="badgeDesc" style="margin-top:8px;">Description</div>
        <div id="badgeTiers" style="margin-top:10px;"></div>
        <div id="badgeXP" class="muted" style="margin-top:6px; font-size:13px;"></div>
      </div>
    </div>
    <canvas id="confetti" style="position:fixed; inset:0; pointer-events:none;"></canvas>
    <!-- Promotional Modal -->
    <div class="modal" id="promoModal" role="dialog" aria-modal="true" aria-labelledby="promoTitle">
      <div class="glass">
        <div class="hero">
          <button class="btn btn-icon close-x" id="promoClose" aria-label="Close">✖</button>
          <h2 id="promoTitle">New Year, New Reading Habit 📚✨</h2>
          <p>Read & Revive (አንባቢ) — a youth-led initiative making reading engaging, accessible, and rewarding in Ethiopia.</p>
        </div>
        <div class="body">
          <div class="muted">This page is the official demo of our Telegram bot. It showcases how you can set goals, track progress, earn achievements, join leagues, and receive daily motivation — all designed to build a lifelong reading habit.</div>
          <div class="feature-grid">
            <div class="feature-card">
              <h3>🌟 Why You'll Love It</h3>
              <div class="muted">🏆 Achievements with XP<br>🎯 Daily goals & tracking<br>⏰ Smart reminders<br>👥 Community leagues<br>✨ Motivational messages</div>
            </div>
            <div class="feature-card cta-card">
              <h3>🚀 Built by Sarfus Innovation</h3>
              <div class="muted" style="margin-bottom: 12px;">Made with care by passionate developers</div>
              <a href="https://www.sarfusinnovation.com" target="_blank" rel="noopener noreferrer" class="cta-sarfus">
                Visit Our Website
              </a>
            </div>
          </div>
        </div>
        <div class="actions">
          <a class="btn primary" href="#demo">🎮 Try Live Demo</a>
          <a class="btn" href="#features">🔍 Explore Features</a>
          <a class="btn" href="https://t.me/sarfus_devlab_bot" target="_blank" rel="noopener noreferrer">🚀 Open Bot</a>
        </div>
      </div>
    </div>

    <script>
      (function() {
        const root = document.documentElement;
        const themeToggle = document.getElementById('themeToggle');
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);
        themeToggle.addEventListener('click', () => {
          const current = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
          if (current === 'light') document.documentElement.setAttribute('data-theme', 'light');
          else document.documentElement.removeAttribute('data-theme');
          localStorage.setItem('theme', document.documentElement.getAttribute('data-theme') || 'dark');
        });

        // Chat demo
        const chatLog = document.getElementById('chatLog');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const promptBtns = Array.from(document.querySelectorAll('[data-prompt]'));
        const suggestions = document.getElementById('suggestions');
        const inlineKb = document.getElementById('inlineKb');
        const demoState = { goal: 20, progressPct: 62, streak: 7, rank: 2 };
        const flowState = { mode: null, expecting: null, addBook: { step: null, data: {} }, featuredPage: 0 };
        const achievements = {
          streak: { key:'streak', title:'🔥 Streak Starter', desc:'Read 3 days in a row.', unlocked: true,
            tiers: {
              Bronze: [
                {label:'Day 1 — First Step', xp:10},
                {label:'Day 3 — First Spark', xp:25},
                {label:'Day 7 — One Week Reader', xp:50},
                {label:'Day 14 — Two-Week Challenger', xp:100},
                {label:'Day 21 — Habit Builder', xp:150},
                {label:'Day 30 — One Month Champion', xp:200},
              ],
              Silver: [
                {label:'Day 50 — Golden Streak', xp:400},
                {label:'Day 75 — Dedicated Reader', xp:600},
                {label:'Day 100 — Century Club', xp:1000},
              ],
              Gold: [
                {label:'Day 150 — Unstoppable', xp:1500},
                {label:'Day 200 — Marathon Mind', xp:2000},
                {label:'Day 250 — Knowledge Seeker', xp:2500},
              ],
              Diamond: [
                {label:'Day 300 — Book Sage', xp:3000},
                {label:'Day 365 — One-Year Legend', xp:5000},
              ]
            }
          },
          marathon: { key:'marathon', title:'🏅 100 Pages Marathon', desc:'100 pages in a week.', unlocked: false,
            tiers: { Bronze:[{label:'100 pages in week', xp:200}] } },
          community: { key:'community', title:'🤝 Community Helper', desc:'Join a league.', unlocked: false,
            tiers: { Bronze:[{label:'League participation', xp:100}] } },
          consistency: { key:'consistency', title:'⭐ Consistency Star', desc:'10 minutes daily for 14 days.', unlocked: false,
            tiers: { Bronze:[{label:'14-day consistency', xp:150}] } },
        };
        function renderAchievements() {
          const grid = document.getElementById('achGrid');
          grid.innerHTML = '';
          Object.values(achievements).forEach(a => {
            const btn = document.createElement('button');
            btn.className = 'badge' + (a.unlocked ? '' : ' locked');
            btn.dataset.badge = a.key;
            btn.textContent = a.title;
            btn.addEventListener('click', () => openBadge(a.key));
            grid.appendChild(btn);
          });
        }
        function openBadge(key) {
          const b = achievements[key]; if (!b) return;
          modalTitle.textContent = b.title; modalDesc.textContent = b.desc;
          const tiersEl = document.getElementById('badgeTiers');
          const xpEl = document.getElementById('badgeXP');
          if (b.tiers) {
            let html = '';
            Object.entries(b.tiers).forEach(([tier, items]) => {
              html += `<div style="margin-top:8px;"><b>${tier}</b><ul style="margin:6px 0 0 16px;">` +
                items.map(it => `<li>${it.label} — <span class=\"muted\">+${it.xp} XP</span></li>`).join('') + '</ul></div>';
            });
            tiersEl.innerHTML = html;
            const totalXp = Object.values(b.tiers).flat().reduce((s,it)=>s+it.xp,0);
            xpEl.textContent = `Total potential XP: ${totalXp}`;
          } else {
            tiersEl.innerHTML = '';
            xpEl.textContent = '';
          }
          modal.classList.add('open');
        }
        const RESPONSES = {
          '/start': { text: "🌟 Welcome to Read & Revive (አንባቢ)!\n\nChoose a mode:", sugg: ["Individual Mode", "Community Mode", "Help"] },
          'help': { text: "Commands: /start /progress /league /achievements /profile\nYou can also choose from the chips below.", sugg: ["Set Daily Goal", "Set Reminder", "View Leaderboard"] },
          'individual': { text: "You chose Individual Mode. What would you like to do?", sugg: ["Set Daily Goal", "Update Progress", "View Profile"] },
          'community': { text: "Community Mode activated. Explore leagues and compete!", sugg: ["Join League", "View Leaderboard", "Community Achievements"] },
          '/progress': { text: "📊 Update your reading progress. Send pages read today (e.g., 15).", sugg: ["15", "20", "30"] },
          '/league': { text: "👥 Leagues: join or view standings.", sugg: ["Join League", "View Leaderboard"] },
          '/achievements': { text: "🏆 Achievements unlocked: Streak Starter, Consistency Star, 100 Pages Marathon.", sugg: ["Open Streak Starter", "Open Consistency Star"] },
          '/profile': { text: "🧑‍💼 Profile: edit details or see insights.", sugg: ["Edit Profile", "Detailed Stats", "Reading Goals"] },
          'set goal': { text: "Enter your daily goal in pages (e.g., 20).", sugg: ["10", "15", "20", "30"] },
          'set reminder': { text: "When should I remind you to read? (e.g., 8:00 PM)", sugg: ["7:00 AM", "8:00 PM", "9:30 PM"] },
          'join league': { text: "Pick a league to join:", sugg: ["Alpha Readers", "Book Sprinters", "Night Owls"] },
          'view leaderboard': { text: "Here’s the current leaderboard.", sugg: ["Refresh", "Back"] },
        };
        function updateKpis() {
          document.querySelector('.hero .grid .card .progress span').style.width = demoState.progressPct + '%';
          document.querySelectorAll('.hero .grid .card')[0].querySelector('.muted + div + .progress + .muted').textContent = demoState.progressPct + '% complete';
          document.querySelectorAll('.hero .grid .card')[0].querySelector('div:nth-child(2)').textContent = demoState.goal + ' pages';
          document.querySelectorAll('.hero .grid .card')[1].querySelector('div:nth-child(2)').textContent = '🔥 ' + demoState.streak + ' days';
          document.querySelectorAll('.hero .grid .card')[2].querySelector('div:nth-child(2)').textContent = (demoState.rank === 1 ? '🥇 ' : demoState.rank === 2 ? '🥈 ' : '🥉 ') + demoState.rank + ' / 12';
        }
        updateKpis();
        function addBubble(text, who) {
          const div = document.createElement('div');
          div.className = `bubble ${who}`;
          div.textContent = text;
          chatLog.appendChild(div);
          chatLog.scrollTop = chatLog.scrollHeight;
          return div;
        }
        function setSuggestions(items=[]) {
          suggestions.innerHTML = '';
          items.forEach(label => {
            const b = document.createElement('button');
            b.className = 'chip';
            b.textContent = label;
            b.addEventListener('click', () => { handleInput(label); });
            suggestions.appendChild(b);
          });
        }
        function attachInlineKb(rows=[]) {
          // Remove previous inline keyboards
          Array.from(chatLog.querySelectorAll('.inline-kb-msg')).forEach(el => el.remove());
          if (!rows || rows.length === 0) return;
          const wrap = document.createElement('div');
          wrap.className = 'inline-kb-msg';
          rows.forEach(row => {
            const rowWrap = document.createElement('div');
            rowWrap.style.display = 'flex'; rowWrap.style.gap = '8px'; rowWrap.style.margin = '6px 0 2px';
            row.forEach(btn => {
              const el = document.createElement('button');
              el.className = 'ikb-btn';
              el.textContent = btn.text;
              el.dataset.action = btn.action;
              el.addEventListener('click', () => handleAction(btn.action));
              rowWrap.appendChild(el);
            });
            wrap.appendChild(rowWrap);
          });
          chatLog.appendChild(wrap);
          chatLog.scrollTop = chatLog.scrollHeight;
        }
        function typingAndReply(text, sugg=[], kbRows=null) {
          const t = addBubble('typing…', 'bot typing');
          setTimeout(() => {
            t.textContent = text;
            t.classList.remove('typing');
            setSuggestions(sugg);
            if (kbRows) attachInlineKb(kbRows); else attachInlineKb([]);
          }, 350);
        }
        function parseGoal(text) {
          const m = text.match(/(\d{1,3})\s*(pages?)?/i);
          return m ? Math.max(1, Math.min(200, parseInt(m[1], 10))) : null;
        }
        function botReply(input) {
          const normalized = input.trim().toLowerCase();
          if (normalized === '/start') { return typingAndReply(RESPONSES['/start'].text, RESPONSES['/start'].sugg, [[{text:'🆕 Individual Mode', action:'mode_individual'},{text:'👥 Community Mode', action:'mode_community'}]]); }
          if (normalized === 'help' || normalized === '/help') return typingAndReply(RESPONSES['help'].text, RESPONSES['help'].sugg);
          if (normalized.includes('individual')) { showIndividualMenu(); return; }
          if (normalized.includes('community')) { showCommunityMenu(); return; }
          if (normalized === '/progress' || normalized.includes('update progress')) return typingAndReply(RESPONSES['/progress'].text, RESPONSES['/progress'].sugg);
          if (normalized === '/league') return typingAndReply(RESPONSES['/league'].text, RESPONSES['/league'].sugg);
          if (normalized === '/achievements') return typingAndReply(RESPONSES['/achievements'].text, RESPONSES['/achievements'].sugg);
          if (normalized === '/profile') return typingAndReply(RESPONSES['/profile'].text, RESPONSES['/profile'].sugg);
          if (normalized.includes('set daily goal') || normalized.startsWith('set goal')) return typingAndReply(RESPONSES['set goal'].text, RESPONSES['set goal'].sugg);
          if (normalized.includes('set reminder')) return typingAndReply(RESPONSES['set reminder'].text, RESPONSES['set reminder'].sugg);
          if (normalized.includes('join league')) return typingAndReply(RESPONSES['join league'].text, RESPONSES['join league'].sugg);
          if (normalized.includes('view leaderboard') || normalized === 'refresh') return typingAndReply(RESPONSES['view leaderboard'].text, RESPONSES['view leaderboard'].sugg);

          const num = parseGoal(input);
          if (num !== null) {
            if (flowState.expecting === 'progress' || normalized.includes('pages') || chatLog.textContent.toLowerCase().includes('update your reading progress')) {
              demoState.progressPct = Math.min(100, demoState.progressPct + Math.round((num/ demoState.goal) * 100));
              typingAndReply(`✅ Logged ${num} pages today. Great job!`, ["View Leaderboard", "Open Consistency Star"]);
              updateKpis();
              // Unlock marathon if threshold reached (demo logic)
              if (!achievements.marathon.unlocked && demoState.progressPct >= 100) {
                achievements.marathon.unlocked = true; renderAchievements(); centerBurst();
                setTimeout(() => typingAndReply('🎉 New achievement unlocked: 100 Pages Marathon!', []), 200);
              }
              flowState.expecting = null;
            } else {
              demoState.goal = num; updateKpis();
              typingAndReply(`🎯 Daily goal set to ${num} pages.`, ["Update Progress", "Set Reminder"]);
            }
            return;
          }
          if (/\d{1,2}:\d{2}\s*(am|pm)/i.test(input)) {
            return typingAndReply(`⏰ Reminder set for ${input}.`, ["Update Progress", "Join League"]);
          }
          if (normalized.includes('open streak')) {
            document.querySelector('[data-badge="streak"]').click();
            return typingAndReply('Opened Streak Starter details.', ["Back", "View Leaderboard"]);
          }
          if (normalized.includes('open consistency')) {
            document.querySelector('[data-badge="consistency"]').click();
            return typingAndReply('Opened Consistency Star details.', ["Back", "Update Progress"]);
          }
          return typingAndReply(`🤖 Not recognized in demo. Try /start or use the chips below.`, ["/start", "Help", "Set Daily Goal"]);
        }
        function showIndividualMenu() {
          flowState.mode = 'individual';
          attachInlineKb([
            [{text:'📚 Books', action:'ind_books_menu'}, {text:'📊 Progress', action:'ind_progress'}],
            [{text:'⏰ Reminder', action:'ind_reminder'}, {text:'🎯 Set Goal', action:'ind_set_goal'}],
            [{text:'🧑‍💼 Profile', action:'view_profile'}]
          ]);
          typingAndReply(RESPONSES['individual'].text, RESPONSES['individual'].sugg);
        }
        function showCommunityMenu() {
          flowState.mode = 'community';
          attachInlineKb([
            [{text:'➕ Join League', action:'join_league'}, {text:'🏆 Leaderboard', action:'view_leaderboard'}],
            [{text:'🎖 Community Achievements', action:'community_achievements'}]
          ]);
          typingAndReply(RESPONSES['community'].text, RESPONSES['community'].sugg);
        }
        const FEATURED = [
          {title:'Atomic Habits', author:'James Clear'},
          {title:'Deep Work', author:'Cal Newport'},
          {title:'Ikigai', author:'García & Miralles'},
          {title:'Alchemist', author:'Paulo Coelho'}
        ];
        function showFeaturedBooks(page=0) {
          flowState.featuredPage = (page+FEATURED.length)%FEATURED.length;
          const b = FEATURED[flowState.featuredPage];
          typingAndReply(`📚 Featured: ${b.title} — ${b.author}\nPage ${flowState.featuredPage+1}/${FEATURED.length}`, []);
          attachInlineKb([
            [{text:`Select "${b.title}"`, action:`select_book_${flowState.featuredPage}`}],
            [{text:'⬅️ Prev', action:'featured_prev'}, {text:'➡️ Next', action:'featured_next'}],
            [{text:'⬅️ Back', action:'ind_books_menu'}]
          ]);
        }
        function handleAction(action) {
          if (action === 'mode_individual') return showIndividualMenu();
          if (action === 'mode_community') return showCommunityMenu();
          if (action === 'ind_books_menu') {
            attachInlineKb([
              [{text:'📖 My Books', action:'ind_my_books'}, {text:'✨ Featured Books', action:'ind_featured_books'}],
              [{text:'➕ Add Book', action:'ind_add_book'}],
              [{text:'⬅️ Back', action:'mode_individual'}]
            ]);
            return typingAndReply('Choose a books option:', []);
          }
          if (action === 'ind_featured_books') return showFeaturedBooks(flowState.featuredPage);
          if (action === 'featured_prev') return showFeaturedBooks(flowState.featuredPage-1);
          if (action === 'featured_next') return showFeaturedBooks(flowState.featuredPage+1);
          if (action.startsWith('select_book_')) {
            const idx = parseInt(action.split('_').pop());
            const bk = FEATURED[idx];
            return typingAndReply(`✅ Added "${bk.title}" to your reading list.`, ["Update Progress", "Set Reminder"]);
          }
          if (action === 'ind_add_book') {
            flowState.addBook = { step: 'title', data: {} };
            return typingAndReply('📘 What is the book title?', []);
          }
          if (action === 'ind_progress') { flowState.expecting = 'progress'; return typingAndReply('📊 Update your reading progress: send pages read today (e.g., 15).', ["15","20","30"]); }
          if (action === 'ind_reminder') { return typingAndReply('⏰ When should I remind you to read? (e.g., 8:00 PM)', ["7:00 AM","8:00 PM","9:30 PM"]); }
          if (action === 'ind_set_goal') {
            return typingAndReply('Current goal: '+demoState.goal+' pages/day. Choose a new goal:', [], [[{text:'10', action:'goal_10'},{text:'15', action:'goal_15'},{text:'20', action:'goal_20'}],[{text:'25', action:'goal_25'},{text:'30', action:'goal_30'},{text:'Custom', action:'goal_custom'}],[{text:'⬅️ Back', action:'mode_individual'}]]);
          }
          if (action.startsWith('goal_')) {
            if (action === 'goal_custom') { flowState.expecting = 'custom_goal'; return typingAndReply('Enter your custom pages per day:', []); }
            demoState.goal = parseInt(action.split('_')[1]); updateKpis();
            return typingAndReply(`🎯 Daily goal set to ${demoState.goal} pages.`, ["Update Progress","Set Reminder"]);
          }
          if (action === 'view_profile') {
            return typingAndReply('🧑‍💼 Profile — choose an action:', [], [[{text:'✏️ Edit Profile', action:'edit_profile'},{text:'📊 Detailed Stats', action:'detailed_stats'}],[{text:'🎯 Reading Goals', action:'reading_goals'}],[{text:'🏠 Main Menu', action:'mode_individual'}]]);
          }
          if (action === 'join_league') {
            return typingAndReply('Pick a league to join:', [], [[{text:'Alpha Readers', action:'join_alpha'},{text:'Book Sprinters', action:'join_sprinters'}],[{text:'Night Owls', action:'join_owls'}],[{text:'⬅️ Back', action:'mode_community'}]]);
          }
          if (action.startsWith('join_')) {
            demoState.rank = 3; updateKpis();
            if (!achievements.community.unlocked) { achievements.community.unlocked = true; renderAchievements(); centerBurst(); }
            return typingAndReply('✅ Joined league! Climb the leaderboard with your reading.', ["View Leaderboard"]);
          }
          if (action === 'view_leaderboard') { return typingAndReply('Here’s the current leaderboard below 👇', []); }
        }
        function handleInput(text) {
          // Handle add book steps and goal custom
          if (flowState.addBook.step === 'title') { flowState.addBook.data.title = text; flowState.addBook.step = 'author'; return typingAndReply('✍️ Author name?', []); }
          if (flowState.addBook.step === 'author') { flowState.addBook.data.author = text; flowState.addBook.step = 'pages'; return typingAndReply('📝 Total pages?', []); }
          if (flowState.addBook.step === 'pages') {
            const num = parseGoal(text); if (!num) return typingAndReply('Please enter a valid number of pages.', []);
            flowState.addBook.step = null; return typingAndReply(`✅ Added "${flowState.addBook.data.title}" by ${flowState.addBook.data.author} (${num} pages).`, ["Update Progress"]);
          }
          if (flowState.expecting === 'custom_goal') { const g = parseGoal(text); if (!g) return typingAndReply('Enter a number like 25.', []); demoState.goal = g; updateKpis(); flowState.expecting = null; return typingAndReply(`🎯 Daily goal set to ${g} pages.`, ["Update Progress"]); }
          addBubble(text, 'user'); botReply(text);
        }
        // Keyboard navigation for inline buttons/chips
        function enableKeyboardNav(container) {
          container.addEventListener('keydown', (e) => {
            const focusables = Array.from(container.querySelectorAll('button'));
            const idx = focusables.indexOf(document.activeElement);
            if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
              const next = focusables[(idx + 1 + focusables.length) % focusables.length];
              if (next) { next.focus(); e.preventDefault(); }
            } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
              const prev = focusables[(idx - 1 + focusables.length) % focusables.length];
              if (prev) { prev.focus(); e.preventDefault(); }
            }
          });
        }
        enableKeyboardNav(document.getElementById('inlineKb'));
        enableKeyboardNav(document.getElementById('suggestions'));
        // Accordion interactivity
        Array.from(document.querySelectorAll('.acc-header')).forEach(h => {
          h.addEventListener('click', () => {
            const item = h.parentElement;
            const open = item.classList.contains('open');
            // close others in same accordion
            Array.from(item.parentElement.querySelectorAll('.acc-item')).forEach(i => { if (i !== item) { i.classList.remove('open'); i.querySelector('.acc-header').setAttribute('aria-expanded','false'); i.querySelector('.acc-content').style.maxHeight = '0px'; }});
            if (open) {
              item.classList.remove('open');
              h.setAttribute('aria-expanded','false');
              item.querySelector('.acc-content').style.maxHeight = '0px';
            } else {
              item.classList.add('open');
              h.setAttribute('aria-expanded','true');
              const c = item.querySelector('.acc-content');
              c.style.maxHeight = c.scrollHeight + 'px';
            }
          });
        });
        sendBtn.addEventListener('click', () => {
          const text = chatInput.value.trim();
          if (!text) return;
          handleInput(text);
          chatInput.value = '';
        });
        chatInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') sendBtn.click(); });
        promptBtns.forEach(btn => btn.addEventListener('click', () => { addBubble(btn.dataset.prompt, 'user'); botReply(btn.dataset.prompt); }));
        // Seed a welcome
        typingAndReply('Type a command like /start to begin…', ["/start", "Help"]);

        // Tips & Quotes rotator
        const TIPS = {
          technique: [
            '📖 Try 25–5 — read 25 min, break 5 min.',
            '🔍 Active Reading: Mark key points or take short notes.',
            '📚 Skim first, then read deeply for retention.'
          ],
          health: [
            '👀 20–20–20 — every 20 min, look 20 ft away for 20s.',
            '💧 Keep water nearby; hydration improves focus.',
            '🪑 Maintain good posture to avoid strain.'
          ],
          habit: [
            '⏰ Consistency beats intensity. 10 min daily > 2 hrs weekly.',
            '🧭 Read at your peak energy time.',
            '📅 Anchor reading to an existing routine.'
          ]
        };
        const QUOTES = {
          reading: [
            '🌟 Every page you read brings you closer to wisdom!',
            "📚 'Books are a uniquely portable magic.' — Stephen King",
            "🎯 'Today a reader, tomorrow a leader.' — Margaret Fuller"
          ],
          growth: [
            "💫 'The secret of getting ahead is getting started.' — Mark Twain",
            "🔥 'The expert in anything was once a beginner.' — Helen Hayes",
            '🚀 Progress, not perfection.'
          ]
        };
        const tipEl = document.getElementById('tipRotator');
        const quoteEl = document.getElementById('quoteRotator');
        let tipCat = 'technique', tipIdx = 0, tipTimer = null;
        let quoteCat = 'reading', quoteIdx = 0, quoteTimer = null;
        function startTipLoop() { stopTipLoop(); tipTimer = setInterval(() => { tipIdx = (tipIdx+1)%TIPS[tipCat].length; tipEl.textContent = TIPS[tipCat][tipIdx]; }, 3600); }
        function stopTipLoop() { if (tipTimer) { clearInterval(tipTimer); tipTimer = null; } }
        function startQuoteLoop() { stopQuoteLoop(); quoteTimer = setInterval(() => { quoteIdx = (quoteIdx+1)%QUOTES[quoteCat].length; quoteEl.textContent = QUOTES[quoteCat][quoteIdx]; }, 4400); }
        function stopQuoteLoop() { if (quoteTimer) { clearInterval(quoteTimer); quoteTimer = null; } }
        startTipLoop(); startQuoteLoop();
        // Category tabs
        Array.from(document.querySelectorAll('[data-tipcat]')).forEach(btn => btn.addEventListener('click', () => {
          Array.from(btn.parentElement.querySelectorAll('button')).forEach(b => b.classList.remove('active'));
          btn.classList.add('active'); tipCat = btn.dataset.tipcat; tipIdx = 0; tipEl.textContent = TIPS[tipCat][0]; startTipLoop();
        }));
        Array.from(document.querySelectorAll('[data-quote]')).forEach(btn => btn.addEventListener('click', () => {
          Array.from(btn.parentElement.querySelectorAll('button')).forEach(b => b.classList.remove('active'));
          btn.classList.add('active'); quoteCat = btn.dataset.quote; quoteIdx = 0; quoteEl.textContent = QUOTES[quoteCat][0]; startQuoteLoop();
        }));
        // Pause buttons
        const tipPause = document.getElementById('tipPause');
        const quotePause = document.getElementById('quotePause');
        tipPause.addEventListener('click', () => {
          const paused = tipPause.getAttribute('aria-pressed') === 'true';
          if (paused) { tipPause.setAttribute('aria-pressed','false'); tipPause.textContent = '⏸ Pause'; startTipLoop(); }
          else { tipPause.setAttribute('aria-pressed','true'); tipPause.textContent = '▶️ Resume'; stopTipLoop(); }
        });
        quotePause.addEventListener('click', () => {
          const paused = quotePause.getAttribute('aria-pressed') === 'true';
          if (paused) { quotePause.setAttribute('aria-pressed','false'); quotePause.textContent = '⏸ Pause'; startQuoteLoop(); }
          else { quotePause.setAttribute('aria-pressed','true'); quotePause.textContent = '▶️ Resume'; stopQuoteLoop(); }
        });

        // Achievements modal
        const modal = document.getElementById('badgeModal');
        const modalTitle = document.getElementById('badgeTitle');
        const modalDesc = document.getElementById('badgeDesc');
        const closeBtn = document.getElementById('badgeClose');
        renderAchievements();
        // Section reveal observer
        const revealEls = Array.from(document.querySelectorAll('.reveal'));
        const io = new IntersectionObserver((entries) => {
          entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('in'); });
        }, { threshold: 0.15 });
        revealEls.forEach(el => io.observe(el));

        // Confetti
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function resizeCanvas() { canvas.width = innerWidth; canvas.height = innerHeight; }
        window.addEventListener('resize', resizeCanvas); resizeCanvas();
        function confettiBurst(x, y, count=80) {
          for (let i=0;i<count;i++) {
            particles.push({ x, y, vx: (Math.random()*2-1)*4, vy: (Math.random()*-2-2), g: 0.08 + Math.random()*0.08, size: 3 + Math.random()*3, c: `hsl(${Math.random()*360}, 90%, 60%)`, life: 60+Math.random()*30 });
          }
        }
        function tickConfetti() {
          ctx.clearRect(0,0,canvas.width, canvas.height);
          particles.forEach(p => { p.vy += p.g; p.x += p.vx; p.y += p.vy; p.life -= 1; ctx.fillStyle = p.c; ctx.fillRect(p.x, p.y, p.size, p.size); });
          particles = particles.filter(p => p.life > 0 && p.y < canvas.height + 10);
          requestAnimationFrame(tickConfetti);
        }
        tickConfetti();
        function centerBurst() { confettiBurst(innerWidth/2, innerHeight*0.25, 140); }
        closeBtn.addEventListener('click', () => modal.classList.remove('open'));
        modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('open'); });
        const observer = new MutationObserver(() => { if (modal.classList.contains('open')) centerBurst(); });
        observer.observe(modal, { attributes: true, attributeFilter: ['class'] });

        // Promo Modal on first load
        const promoModal = document.getElementById('promoModal');
        const promoClose = document.getElementById('promoClose');
        const HAS_SEEN_PROMO = 'has_seen_promo_v1';
        function openPromo() { promoModal.classList.add('open'); }
        function closePromo() { promoModal.classList.remove('open'); localStorage.setItem(HAS_SEEN_PROMO, '1'); }
        if (!localStorage.getItem(HAS_SEEN_PROMO)) {
          setTimeout(openPromo, 400);
        }
        promoClose.addEventListener('click', closePromo);
        promoModal.addEventListener('click', (e) => { if (e.target === promoModal) closePromo(); });

        // Leaderboard (animated + filters)
        const LB = {
          weekly: [
            { user: 'You', pages: 172, pct: 86 },
            { user: 'Selam', pages: 185, pct: 92 },
            { user: 'Muna', pages: 150, pct: 75 },
            { user: 'Yonatan', pages: 120, pct: 60 },
          ],
          monthly: [
            { user: 'Selam', pages: 690, pct: 88 },
            { user: 'You', pages: 640, pct: 82 },
            { user: 'Abel', pages: 600, pct: 77 },
            { user: 'Muna', pages: 540, pct: 70 },
          ],
          all: [
            { user: 'Selam', pages: 5820, pct: 100 },
            { user: 'Abel', pages: 5450, pct: 94 },
            { user: 'You', pages: 5200, pct: 90 },
            { user: 'Muna', pages: 4800, pct: 83 },
          ],
        };
        let currentPeriod = 'weekly';
        const tbody = document.querySelector('#leaderboard tbody');
        const periodButtons = Array.from(document.querySelectorAll('[data-period]'));
        periodButtons.forEach(b => b.addEventListener('click', () => {
          periodButtons.forEach(x => x.classList.remove('active'));
          b.classList.add('active');
          currentPeriod = b.dataset.period;
          renderLeaderboard(true);
        }));
        function renderLeaderboard(animated=false) {
          const data = [...LB[currentPeriod]];
          // sort by pages desc
          data.sort((a,b) => b.pages - a.pages);
          tbody.innerHTML = '';
          data.forEach((row, idx) => {
            const tr = document.createElement('tr');
            tr.className = 'row-anim' + (row.user === 'You' ? ' highlight' : '');
            const bar = `<div class=\"progress\"><span style=\"width:${animated ? 0 : row.pct}%\"></span></div>`;
            tr.innerHTML = `<td>${idx+1}</td><td>${row.user}</td><td>${row.pages}</td><td>${bar}</td>`;
            tbody.appendChild(tr);
            if (animated) requestAnimationFrame(() => {
              const span = tr.querySelector('.progress > span');
              span.style.transition = 'width .6s ease';
              span.style.width = row.pct + '%';
            });
          });
        }
        renderLeaderboard(true);
        setInterval(() => {
          // gentle shuffle within current period
          LB[currentPeriod].sort(() => Math.random() - 0.5);
          renderLeaderboard(true);
        }, 7000);

        // Simple charts (inline SVG)
        function donutChart(el, pct) {
          const size = 160, stroke = 16, r = (size - stroke)/2, c = 2 * Math.PI * r;
          el.innerHTML = `<svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
            <circle cx="${size/2}" cy="${size/2}" r="${r}" stroke="rgba(255,255,255,.1)" stroke-width="${stroke}" fill="none"/>
            <circle cx="${size/2}" cy="${size/2}" r="${r}" stroke="url(#g)" stroke-width="${stroke}" fill="none" stroke-linecap="round" stroke-dasharray="${c}" stroke-dashoffset="${c * (1 - pct)}" transform="rotate(-90 ${size/2} ${size/2})"/>
            <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="var(--accent)"/><stop offset="100%" stop-color="var(--primary)"/></linearGradient></defs>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="var(--text)" font-size="20" font-weight="700">${Math.round(pct*100)}%</text>
          </svg>`;
        }
        function barChart(el, values) {
          const w = el.clientWidth - 24, h = 140, pad = 16, max = Math.max(...values, 1);
          const barW = (w - pad*2) / values.length - 10;
          const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          svg.setAttribute('width', String(w)); svg.setAttribute('height', String(h));
          svg.innerHTML = values.map((v, i) => {
            const x = pad + i*(barW+10);
            const bh = (v/max) * (h - pad*2);
            const y = h - pad - bh;
            return `<rect x="${x}" y="${y}" width="${barW}" height="${bh}" rx="6" fill="url(#gb)" />`;
          }).join('') + `<defs><linearGradient id="gb" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="var(--accent)"/><stop offset="100%" stop-color="var(--primary)"/></linearGradient></defs>`;
          el.innerHTML = '';
          el.appendChild(svg);
        }
        donutChart(document.getElementById('donutChart'), 0.68);
        barChart(document.getElementById('barChart'), [12, 18, 9, 22, 16, 28, 14]);
        // Second donut: goals achieved
        donutChart(document.getElementById('donutGoals'), 0.55);
        // Sparkline for streak trend
        function sparkline(el, values) {
          const w = el.clientWidth - 24, h = 80, padX = 10, padY = 10;
          const min = Math.min(...values), max = Math.max(...values);
          const xStep = (w - padX*2) / (values.length - 1);
          const scaleY = (v) => max === min ? h/2 : (h - padY*2) * (1 - (v - min) / (max - min)) + padY;
          const points = values.map((v, i) => `${padX + i*xStep},${scaleY(v)}`).join(' ');
          const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          svg.setAttribute('width', String(w)); svg.setAttribute('height', String(h));
          svg.innerHTML = `
            <polyline points="${points}" fill="none" stroke="var(--primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="${padX + (values.length-1)*xStep}" cy="${scaleY(values[values.length-1])}" r="3" fill="var(--accent)"/>
          `;
          el.innerHTML = '';
          el.appendChild(svg);
        }
        sparkline(document.getElementById('streakSpark'), [3,4,5,6,5,7,8,9,7,10,9,11]);

        // Animated counters
        function animateCount(id, target, duration=900) {
          const el = document.getElementById(id);
          const start = performance.now();
          function step(now) {
            const p = Math.min(1, (now - start)/duration);
            el.textContent = Math.round(p * target);
            if (p < 1) requestAnimationFrame(step);
          }
          requestAnimationFrame(step);
        }
        animateCount('countPages', 4321);
        animateCount('countBooks', 12);
        animateCount('countStreak', 21);
      })();
    </script>
  </body>
</html>


